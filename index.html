<!DOCTYPE html>
<html>
<head>
    <title>Associate Schedule</title>
    <style>
        /* Add your CSS here */
    </style>

    <!-- Load vis-timeline library -->
    <script src="vis/dist/vis.js"></script>

    <!-- Load vis-timeline styles -->
    <link href="vis/dist/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <h1>Associate Schedule</h1>
    <div>
        <label for="associate-name">Associate Name:</label>
        <input type="text" id="associate-name">
    </div>
    <div>
        <label for="is-minor">Is Minor?</label>
        <input type="checkbox" id="is-minor">
    </div>
    <div>
        <label for="shift-start">Shift Start Time:</label>
        <input type="time" id="shift-start">
    </div>
    <div>
        <label for="shift-end">Shift End Time:</label>
        <input type="time" id="shift-end">
    </div>
    <button onclick="addShift()">Add Shift</button>
    <div id="timeline"></div>

    <script type="text/javascript">
        // Array to hold all the shift data
        var shifts = [];

        // Initialize timeline
    var container = document.getElementById('timeline');
    var items = new vis.DataSet();
    var timeline = new vis.Timeline(container, items);
    editable: {
        updateTime: true, // Allow moving items
        remove: true, // Allow items to be deleted
    },
    onMove: function (item, callback) {
        // Save the new item positions
        // The properties object contains the ids of the moved items and their old and new dates
        console.log(item);
        callback(item);
    },
};
var timeline = new vis.Timeline(container, items, options);

    </script>

    <script type="text/javascript">
        var options = {
        editable: {
            updateTime: true, // Allow moving items
            updateGroup: true, // Allow moving items from one group to another
            remove: true, // Allow items to be deleted
        },
        onMove: function (item, callback) {
            // Prevent items from being moved to overlap other items or outside the shift time
            var otherItems = items.get({filter: i => i.id !== item.id});
            var shift = shifts.find(s => s.id === item.id || item.id.startsWith(`${s.id}-`));
            item.start = Math.max(item.start, shift.start);
            item.end = Math.min(item.end, shift.end);
            otherItems.forEach(i => {
                if (item.start < i.end && item.end > i.start) {
                    if (Math.abs(item.start - i.end) < Math.abs(item.end - i.start)) {
                        item.start = i.end;
                    } else {
                        item.end = i.start;
                    }
                }
            });
            callback(item);
        },
    };
    timeline.setOptions(options);
    </script>

    <script type="text/javascript">
        var timeline = new vis.Timeline(container, items, options);
    </script>

    <script type="text/javascript">
        timeline.on('move', function (properties) {
        // Save the new item positions
        // The properties object contains the ids of the moved items and their old and new dates
        console.log(properties);
    });
    </script>

    <script type="text/javascript">
        function addShift() {
            var name = document.getElementById('associate-name').value;
            var isMinor = document.getElementById('is-minor').checked;
            var start = new Date(`1970-01-01T${document.getElementById('shift-start').value}Z`);
            var end = new Date(`1970-01-01T${document.getElementById('shift-end').value}Z`);

            if (name === '' || isNaN(start.getTime()) || isNaN(end.getTime())) {
                alert('Please enter the associate name and shift times.');
                return;
            }

            var shift = generateShift(name, start, end, isMinor);
            shifts.push(shift);

            items.add(shiftToTimelineItem(shift));

            timeline.fit();  // Adjust the view to show all items
        }
    </script>

    <script type="text/javascript">
    function generateShift(name, start, end, isMinor) {
        var shiftDuration = end - start;
        var id = Math.random().toString(36).substr(2, 9);  // Generate a random id

        var breaks = [];
        var lunchStart, lunchEnd;

        if (shiftDuration <= 5 * 60 * 60 * 1000) {  // Less than 5 hours
            breaks.push({
                start: new Date(start.getTime() + shiftDuration / 2 - 15 * 60 * 1000),
                end: new Date(start.getTime() + shiftDuration / 2 + 15 * 60 * 1000),
            });
        } else if (shiftDuration <= 6 * 60 * 60 * 1000) {  // Between 5 and 6 hours
            if (isMinor) {
                breaks.push({
                    start: new Date(start.getTime() + shiftDuration / 3 - 15 * 60 * 1000),
                    end: new Date(start.getTime() + shiftDuration / 3 + 15 * 60 * 1000),
                });
                lunchStart = new Date(start.getTime() + shiftDuration * 2 / 3 - 30 * 60 * 1000);
                lunchEnd = new Date(start.getTime() + shiftDuration * 2 / 3 + 30 * 60 * 1000);
            } else {
                breaks.push({
                    start: new Date(start.getTime() + shiftDuration / 3 - 15 * 60 * 1000),
                    end: new Date(start.getTime() + shiftDuration / 3 + 15 * 60 * 1000),
                });
                breaks.push({
                    start: new Date(start.getTime() + shiftDuration * 2 / 3 - 15 * 60 * 1000),
                    end: new Date(start.getTime() + shiftDuration * 2 / 3 + 15 * 60 * 1000),
                });
            }
        } else {  // More than 6 hours
            breaks.push({
                start: new Date(start.getTime() + shiftDuration / 4 - 15 * 60 * 1000),
                end: new Date(start.getTime() + shiftDuration / 4 + 15 * 60 * 1000),
            });
            breaks.push({
                start: new Date(start.getTime() + shiftDuration * 3 / 4 - 15 * 60 * 1000),
                end: new Date(start.getTime() + shiftDuration * 3 / 4 + 15 * 60 * 1000),
            });
            lunchStart = new Date(start.getTime() + shiftDuration / 2 - 30 * 60 * 1000);
            lunchEnd = new Date(start.getTime() + shiftDuration / 2 + 30 * 60 * 1000);
        }

        return {
            id: id,
            name: name,
            start: start,
            end: end,
            breaks: breaks,
            lunchStart: lunchStart,
            lunchEnd: lunchEnd,
        };
    }
</script>


    <script type="text/javascript">
        function shiftToTimelineItem(shift) {
            var items = [
                {id: shift.id, content: `${shift.name} (Shift)`, start: shift.start, end: shift.end}
            ];

            shift.breaks.forEach((breakTime, i) => {
                items.push({id: `${shift.id}-break-${i+1}`, content: `${shift.name} (Break ${i+1})`, start: breakTime.start, end: breakTime.end});
            });

            if (shift.lunchStart && shift.lunchEnd) {
                items.push({id: `${shift.id}-lunch`, content: `${shift.name} (Lunch)`, start: shift.lunchStart, end: shift.lunchEnd});
            }

            return items;
        }
    </script>
</body>
</html>
